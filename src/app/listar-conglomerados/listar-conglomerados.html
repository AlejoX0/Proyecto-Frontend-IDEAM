<app-navbar></app-navbar>

<div class="listar-wrapper">
  <div class="listar-card">
    <h2>üó∫Ô∏è Listado de Conglomerados</h2>

    <div *ngIf="cargando" class="loading">Cargando conglomerados...</div>

    <div *ngIf="!cargando && conglomerados.length > 0" class="filters-container">
      
      <div class="filter-group">
        <label for="filtro-id">ID Conglomerado</label>
        <input 
          type="text" 
          id="filtro-id" 
          placeholder="Buscar por ID..."
          [(ngModel)]="filtros.id"
          (input)="aplicarFiltros()">
      </div>
      
      <div class="filter-group">
        <label for="filtro-codigo">C√≥digo</label>
        <input 
          type="text" 
          id="filtro-codigo" 
          placeholder="Buscar por C√≥digo..."
          [(ngModel)]="filtros.codigo"
          (input)="aplicarFiltros()">
      </div>

      <div class="filter-group">
        <label for="filtro-estado">Estado</label>
        <select 
          id="filtro-estado"
          [(ngModel)]="filtros.estado"
          (change)="aplicarFiltros()">
          
          <option value="">-- Todos --</option>
          <option *ngFor="let estado of estadosUnicos" [value]="estado">
            {{ estado | titlecase }} 
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filtro-brigada">ID Brigada</label>
        <input 
          type="text" 
          id="filtro-brigada"
          placeholder="Buscar por ID..."
          [(ngModel)]="filtros.brigada"
          (input)="aplicarFiltros()">
      </div>

      <button (click)="limpiarFiltros()" class="btn-limpiar">
        Limpiar
      </button>
    </div>

    <div *ngIf="!cargando && conglomerados.length > 0" class="table-wrapper">
      <table class="conglomerado-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>C√≥digo</th>
            <th>Latitud</th>
            <th>Longitud</th>
            <th>Estado</th>
            <th>Brigada Asignada</th>
          </tr>
        </thead>
        <tbody *ngIf="conglomeradosFiltrados.length > 0">
          <tr *ngFor="let c of conglomeradosFiltrados">
            <td>{{ c.id_conglomerado }}</td>
            <td>{{ c.codigo }}</td>
            <td>{{ c.lat | number:'1.6-6' }}</td> 
            <td>{{ c.lng | number:'1.6-6' }}</td>
            <td>{{ c.estado | titlecase }}</td>
            <td>{{ c.id_brigada || '‚Äî' }}</td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="conglomeradosFiltrados.length === 0" class="empty-filtered">
        No se encontraron conglomerados con esos filtros.
      </div>
    </div>

    <div *ngIf="!cargando && conglomerados.length === 0" class="empty">
      No hay conglomerados registrados.
    </div>
  </div>
</div>