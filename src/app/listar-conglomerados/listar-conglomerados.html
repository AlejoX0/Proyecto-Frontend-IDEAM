<app-navbar></app-navbar>

<div class="page-bg">

  <div class="listar-card">

    <h2>üìã Listado de Conglomerados</h2>
    <p class="subtitle">Consulta, filtra y analiza la informaci√≥n registrada.</p>

    <!-- CARGANDO -->
    <div *ngIf="cargando" class="loading">Cargando conglomerados...</div>

    <!-- FILTROS -->
    <div *ngIf="!cargando && conglomerados.length > 0" class="filters-container">

      <!-- Filtro ID -->
      <div class="filter-group">
        <label>ID Conglomerado</label>
        <input
          type="text"
          placeholder="Buscar por ID..."
          [(ngModel)]="filtros.id"
          (input)="aplicarFiltros()"
        />
      </div>

      <!-- Filtro C√≥digo -->
      <div class="filter-group">
        <label>C√≥digo</label>
        <input
          type="text"
          placeholder="C√≥digo..."
          [(ngModel)]="filtros.codigo"
          (input)="aplicarFiltros()"
        />
      </div>

      <!-- Filtro Estado -->
      <div class="filter-group">
        <label>Estado</label>
        <select
          [(ngModel)]="filtros.estado"
          (change)="aplicarFiltros()"
        >
          <option value="">-- Todos --</option>
          <option *ngFor="let es of estadosUnicos" [value]="es">
            {{ es }}
          </option>
        </select>
      </div>

      <!-- Filtro Brigada -->
      <div class="filter-group">
        <label>ID Brigada</label>
        <input
          type="text"
          placeholder="Buscar por brigada..."
          [(ngModel)]="filtros.brigada"
          (input)="aplicarFiltros()"
        />
      </div>

      <!-- BOT√ìN LIMPIAR -->
      <button class="btn-limpiar" (click)="limpiarFiltros()">Limpiar ‚ùå</button>
    </div>

    <!-- TABLA -->
    <div
      *ngIf="!cargando && conglomeradosFiltrados.length > 0"
      class="table-wrapper"
    >
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>C√≥digo</th>
            <th>Latitud</th>
            <th>Longitud</th>
            <th>Estado</th>
            <th>ID Brigada</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let c of conglomeradosFiltrados">
            <td>{{ c.id_conglomerado }}</td>
            <td>{{ c.codigo }}</td>
            <td>{{ c.lat }}</td>
            <td>{{ c.lng }}</td>
            <td>{{ c.estado }}</td>
            <td>{{ c.id_brigada || '‚Äî' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- SIN RESULTADOS FILTRADOS -->
    <div
      *ngIf="!cargando && conglomerados.length > 0 && conglomeradosFiltrados.length === 0"
      class="empty-filtered"
    >
      No se encontraron resultados con los filtros aplicados.
    </div>

    <!-- SIN DATOS -->
    <div
      *ngIf="!cargando && conglomerados.length === 0"
      class="empty"
    >
      No hay conglomerados registrados.
    </div>

  </div>
</div>
