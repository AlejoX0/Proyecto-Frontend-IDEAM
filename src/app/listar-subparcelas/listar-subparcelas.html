<app-navbar></app-navbar>

<div class="page-bg">

  <div class="listar-card">

    <h2>üå± Listado de Subparcelas</h2>
    <p class="subtitle">Filtra y consulta todas las subparcelas registradas.</p>

    <!-- Estado de carga -->
    <div *ngIf="cargando" class="loading">
      Cargando subparcelas...
    </div>

    <!-- Error -->
    <div *ngIf="error" class="error-box">
      {{ error }}
    </div>

    <!-- Filtros -->
    <div 
      *ngIf="!cargando && subparcelasMaestra.length > 0" 
      class="filters-container"
    >

      <!-- FILTRO: Conglomerado -->
      <div class="filter-group">
        <label>Conglomerado</label>
        <select [(ngModel)]="filtroConglomerado" (change)="aplicarFiltros()">
          <option value="">-- Todos --</option>
          <option *ngFor="let id of conglomeradosUnicos" [value]="id">
            {{ id }}
          </option>
        </select>
      </div>

      <!-- FILTRO: Categor√≠a -->
      <div class="filter-group">
        <label>Categor√≠a</label>
        <select [(ngModel)]="filtroCategoria" (change)="aplicarFiltros()">
          <option value="">-- Todas --</option>
          <option *ngFor="let c of categoriasUnicas" [value]="c">
            {{ c }}
          </option>
        </select>
      </div>

      <!-- Bot√≥n de limpieza -->
      <button class="btn-limpiar" (click)="limpiarFiltros()">Limpiar ‚ùå</button>

    </div>

    <!-- TABLA -->
    <div 
      *ngIf="!cargando && subparcelas.length > 0" 
      class="table-wrapper"
    >
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>ID Conglomerado</th>
            <th>Categor√≠a</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let sp of subparcelas">
            <td>{{ sp.id_subparcela }}</td>
            <td>{{ sp.id_conglomerado }}</td>
            <td>{{ sp.categoria }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Sin coincidencias -->
    <div 
      *ngIf="!cargando && subparcelasMaestra.length > 0 && subparcelas.length === 0" 
      class="empty-filtered"
    >
      No hay resultados para los filtros aplicados.
    </div>

    <!-- Sin registros -->
    <div 
      *ngIf="!cargando && subparcelasMaestra.length === 0" 
      class="empty"
    >
      No hay subparcelas registradas.
    </div>

  </div>

</div>
